#!/usr/bin/env node

require("ts-node/register");

const tarFs = require("tar-fs");

const deploy = require("../src/deploy").default;

const DEPLOYMENT_KEY = process.env.DEPLOYMENT_KEY;

const [buildDirectory, uploadUrl] = process.argv.slice(2);

const pack = tarFs.pack(buildDirectory);

deploy({
  stream: pack,
  uploadUrl,
  deploymentKey: DEPLOYMENT_KEY
})
  .then((data) => {
    console.log(data.deploymentUrl);
  })
  .catch((e) => {
    if (e.statusCode) console.error("Error status: ", e.status);
    else console.error(e);
  });
